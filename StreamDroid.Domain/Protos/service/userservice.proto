syntax = "proto3";

import "common/user.proto";
import "google/protobuf/empty.proto";
import "google/api/annotations.proto";
import "google/api/httpbody.proto";

service GrpcUserService {
  rpc GenerateLoginUrl(SessionRequest) returns (LoginUrlResponse);
  rpc AuthenticateUser(AuthenticationRequest) returns (google.api.HttpBody) {
    option (google.api.http) = {
      get: "/redirect"
    };
  }
  rpc MonitorAuthenticationSessionStatus(SessionRequest) returns (stream SessionStatus);
  rpc FindUser(google.protobuf.Empty) returns (UserResponse);
}

message SessionRequest {
  string session_id = 1;
}

message LoginUrlResponse {
  string session_id = 1;
  string authorization_url = 2;
}

message SessionStatus {
    enum Status {
        PENDING = 0;
        AUTHORIZED = 1;
        ERROR = 2;
    }

    Status status = 1;
    string access_token = 2;
    string message = 3;
}

message AuthenticationRequest {
  string code = 1; 
  string state = 2;   
  string error = 3; 
  string error_description = 4;
}

message AuthenticationResponse {
  string message = 1;
}

message UserResponse {
  grpc.model.User user = 1;
}